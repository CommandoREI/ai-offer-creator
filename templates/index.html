<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Offer Creator - Real Estate Commando</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #245c3b 0%, #1a4429 100%);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: none;
        }

        .header h1 {
            color: #ffffff;
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            color: #c8e6c9;
            font-size: 16px;
        }

        .mode-toggle {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mode-buttons {
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #245c3b;
            background: #ffffff;
            color: #245c3b;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #245c3b;
            color: #ffffff;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }

        .card {
            background: #ffffff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .card h2 {
            color: #245c3b;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 2px solid #245c3b;
            padding-bottom: 10px;
        }

        .strategy-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .offer-config {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .offer-config h3 {
            color: #245c3b;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #245c3b;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group select,
        .form-group input[type="number"],
        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: #ffffff;
            border: 1px solid #cccccc;
            border-radius: 5px;
            color: #333333;
            font-size: 14px;
        }

        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #245c3b;
            box-shadow: 0 0 0 3px rgba(36, 92, 59, 0.1);
        }

        .weight-slider {
            margin-top: 15px;
        }

        .weight-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .weight-value {
            font-size: 24px;
            font-weight: bold;
            color: #245c3b;
        }

        .weight-label {
            font-size: 12px;
            color: #9e9e9e;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #245c3b;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #245c3b;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .presets {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .preset-btn {
            padding: 10px 16px;
            background: #ffffff;
            border: 2px solid #245c3b;
            color: #245c3b;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            background: #245c3b;
            color: #ffffff;
        }

        .strategy-info {
            background: #f0f7f4;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid #245c3b;
        }

        .strategy-info h4 {
            color: #245c3b;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .strategy-info p {
            color: #666666;
            font-size: 13px;
            line-height: 1.5;
        }

        .strategy-info ul {
            margin-top: 8px;
            padding-left: 20px;
        }

        .strategy-info li {
            color: #666666;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #245c3b 0%, #1a4429 100%);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(76, 175, 80, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results {
            display: none;
        }

        .results.show {
            display: block;
        }

        .offer-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .offer-card {
            background: #ffffff;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #245c3b;
        }

        .offer-card h3 {
            color: #245c3b;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .offer-detail {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .offer-detail:last-child {
            border-bottom: none;
        }

        .offer-detail-label {
            color: #9e9e9e;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .offer-detail-value {
            color: #333333;
            font-size: 16px;
            font-weight: bold;
        }

        .benefits-list {
            margin-top: 15px;
        }

        .benefits-list h4 {
            color: #245c3b;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .benefits-list ul {
            list-style: none;
            padding: 0;
        }

        .benefits-list li {
            color: #333333;
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            font-size: 14px;
        }

        .benefits-list li:before {
            content: "‚úì";
            color: #245c3b;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .presentation-script {
            background: #f0f7f4;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #245c3b;
        }

        .presentation-script h3 {
            color: #245c3b;
            margin-bottom: 15px;
        }

        .presentation-script p {
            color: #333333;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-export {
            flex: 1;
            padding: 14px 24px;
            border: 2px solid #245c3b;
            background: #ffffff;
            color: #245c3b;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-export:hover {
            background: #245c3b;
            color: #ffffff;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #245c3b;
            font-size: 18px;
        }

        .spinner {
            border: 4px solid #e0e0e0;
            border-top: 4px solid #245c3b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .advanced-section {
            display: none;
        }

        .advanced-section.show {
            display: block;
        }

        @media (max-width: 768px) {
            .strategy-selector,
            .offer-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ AI Offer Creator</h1>
            <p>Generate strategic offer scenarios with AI-powered positioning</p>
        </div>

        <div class="mode-toggle">
            <div>
                <strong style="color: #245c3b;">Mode:</strong>
                <span id="modeDescription" style="color: #666666; margin-left: 10px;">Quick strategy selection</span>
            </div>
            <div class="mode-buttons">
                <button class="mode-btn active" onclick="setMode('simple')">üü¢ Simple Mode</button>
                <button class="mode-btn" onclick="setMode('advanced')">üîµ Advanced Mode</button>
            </div>
        </div>

        <div id="inputSection">
            <!-- Strategy Selection -->
            <div class="card">
                <h2>1Ô∏è‚É£ Select Offer Strategies</h2>
                
                <div class="form-group">
                    <label>Quick Presets:</label>
                    <div class="presets">
                        <button class="preset-btn" onclick="applyPreset('sub2_vs_cash')">Subject-To vs Cash</button>
                        <button class="preset-btn" onclick="applyPreset('two_sub2')">Two Subject-To Variations</button>
                        <button class="preset-btn" onclick="applyPreset('creative')">Creative Options</button>
                        <button class="preset-btn" onclick="applyPreset('stacked')">Stacked Deck (80/20)</button>
                    </div>
                </div>

                <div class="strategy-selector">
                    <!-- Offer A -->
                    <div class="offer-config">
                        <h3>Offer A</h3>
                        <div class="form-group">
                            <label>Strategy:</label>
                            <select id="strategy1" onchange="updateStrategyInfo('strategy1', 'info1'); toggleMaxOfferField();">
                                <option value="cash">All Cash</option>
                                <option value="subject_to" selected>Subject-To (Take Over Payments)</option>
                                <option value="lease_option">Lease Option</option>
                                <option value="seller_financing">Seller Financing</option>
                                <option value="hybrid">Hybrid (Cash + Terms)</option>
                            </select>
                        </div>
                        
                        <div class="weight-slider">
                            <div class="weight-display">
                                <span class="weight-label">Attractiveness:</span>
                                <span class="weight-value" id="weight1Display">70%</span>
                            </div>
                            <input type="range" id="weight1" min="0" max="100" value="70" 
                                   oninput="updateWeight('weight1', 'weight1Display', 'weight2', 'weight2Display')">
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span style="font-size: 11px; color: #9e9e9e;">Less Attractive</span>
                                <span style="font-size: 11px; color: #9e9e9e;">More Attractive</span>
                            </div>
                        </div>

                        <div id="info1" class="strategy-info"></div>
                    </div>

                    <!-- Offer B -->
                    <div class="offer-config">
                        <h3>Offer B</h3>
                        <div class="form-group">
                            <label>Strategy:</label>
                            <select id="strategy2" onchange="updateStrategyInfo('strategy2', 'info2'); toggleMaxOfferField();">
                                <option value="cash" selected>All Cash</option>
                                <option value="subject_to">Subject-To (Take Over Payments)</option>
                                <option value="lease_option">Lease Option</option>
                                <option value="seller_financing">Seller Financing</option>
                                <option value="hybrid">Hybrid (Cash + Terms)</option>
                            </select>
                        </div>
                        
                        <div class="weight-slider">
                            <div class="weight-display">
                                <span class="weight-label">Attractiveness:</span>
                                <span class="weight-value" id="weight2Display">30%</span>
                            </div>
                            <input type="range" id="weight2" min="0" max="100" value="30" 
                                   oninput="updateWeight('weight2', 'weight2Display', 'weight1', 'weight1Display')">
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span style="font-size: 11px; color: #9e9e9e;">Less Attractive</span>
                                <span style="font-size: 11px; color: #9e9e9e;">More Attractive</span>
                            </div>
                        </div>

                        <div id="info2" class="strategy-info"></div>
                    </div>
                </div>
            </div>

            <!-- Property Data -->
            <div class="card">
                <h2>2Ô∏è‚É£ Property Information</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>ARV (After Repair Value):</label>
                        <input type="number" id="arv" placeholder="150000" value="150000">
                    </div>

                    <div class="form-group">
                        <label>Current Mortgage Balance:</label>
                        <input type="number" id="mortgage_balance" placeholder="95000" value="95000">
                    </div>
                    <div class="form-group">
                        <label>Monthly Mortgage Payment:</label>
                        <input type="number" id="monthly_payment" placeholder="850" value="850">
                    </div>
                    <div class="form-group">
                        <label>Arrears/Back Payments:</label>
                        <input type="number" id="arrears" placeholder="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Property Condition (1-10):</label>
                        <input type="number" id="condition" min="1" max="10" placeholder="5" value="5">
                    </div>
                </div>
            </div>

            <!-- Seller Data -->
            <div class="card">
                <h2>3Ô∏è‚É£ Seller Situation</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Motivation Score (1-10):</label>
                        <input type="number" id="motivation_score" min="1" max="10" placeholder="8" value="8">
                    </div>
                    <div class="form-group">
                        <label>Primary Pain Point:</label>
                        <select id="pain_point">
                            <option value="financial_distress">Financial Distress</option>
                            <option value="time_pressure">Time Pressure</option>
                            <option value="property_condition">Property Condition</option>
                            <option value="distance">Geographic Distance</option>
                            <option value="inheritance">Inheritance/Estate</option>
                            <option value="divorce">Divorce</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Timeline:</label>
                        <select id="timeline">
                            <option value="immediate">Immediate (Days)</option>
                            <option value="30_days">30 Days</option>
                            <option value="60_days">60 Days</option>
                            <option value="90_days">90+ Days</option>
                            <option value="flexible">Flexible</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Seller's Cash Request:</label>
                        <input type="number" id="seller_cash_request" placeholder="5000" value="5000">
                    </div>
                    <div class="form-group">
                        <label>Estimated Closing Costs:</label>
                        <input type="number" id="closing_costs" placeholder="3000" value="3000">
                        <small style="color: #888; display: block; margin-top: 5px;">Added to purchase price to cover transaction costs</small>
                    </div>
                </div>
            </div>

            <!-- Investor Criteria -->
            <div class="card">
                <h2>4Ô∏è‚É£ Your Investment Criteria</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group" id="max_offer_field">
                        <label>Max Cash Offer (% of ARV):</label>
                        <input type="number" id="max_offer_percent" min="50" max="100" placeholder="70" value="70">
                        <small style="color: #9e9e9e; display: block; margin-top: 5px;">Only applies to all-cash offers</small>
                    </div>
                    <div class="form-group">
                        <label>Minimum Profit Target:</label>
                        <input type="number" id="min_profit" placeholder="20000" value="20000">
                    </div>
                    <div class="form-group">
                        <label>Available Cash:</label>
                        <input type="number" id="available_cash" placeholder="10000" value="10000">
                    </div>
                    <div class="form-group">
                        <label>Exit Strategy:</label>
                        <select id="exit_strategy">
                            <option value="flip">Flip</option>
                            <option value="wholesale">Wholesale</option>
                            <option value="rental">Rental/Hold</option>
                            <option value="brrrr">BRRRR</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Creative Financing Terms -->
            <div class="card">
                <h2>5Ô∏è‚É£ Creative Financing Terms</h2>
                <p style="color: #9e9e9e; margin-bottom: 20px;">These fields appear based on your selected strategies</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Lease Option Fields -->
                    <div class="form-group creative-field lease-option-field" style="display: none;">
                        <label>Option Term (months):</label>
                        <select id="option_term_months">
                            <option value="24">24 months</option>
                            <option value="36" selected>36 months</option>
                            <option value="48">48 months</option>
                            <option value="60">60 months</option>
                        </select>
                        <small style="color: #9e9e9e; display: block; margin-top: 5px;">For Lease Option deals</small>
                    </div>
                    <div class="form-group creative-field lease-option-field" style="display: none;">
                        <label>Additional Amount for Option Price:</label>
                        <input type="number" id="additional_option_price" placeholder="10000" value="0">
                        <small style="color: #9e9e9e; display: block; margin-top: 5px;">Amount to add to mortgage balance</small>
                    </div>
                    <!-- Seller Financing (Wrap) Fields -->
                    <div class="form-group creative-field seller-financing-field" style="display: none;">
                        <label>Monthly Payment Markup:</label>
                        <input type="number" id="monthly_payment_markup" placeholder="200" value="0">
                        <small style="color: #9e9e9e; display: block; margin-top: 5px;">Amount to add to PITI for seller</small>
                    </div>
                    <div class="form-group creative-field seller-financing-field" style="display: none;">
                        <label>Additional Purchase Price:</label>
                        <input type="number" id="additional_purchase_price" placeholder="10000" value="0">
                        <small style="color: #9e9e9e; display: block; margin-top: 5px;">Amount to add to mortgage balance</small>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="card advanced-section" id="advancedSettings">
                <h2>‚öôÔ∏è Advanced Settings</h2>
                <p style="color: #9e9e9e; margin-bottom: 20px;">Fine-tune specific terms and conditions</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Force Specific Price Range:</label>
                        <input type="text" id="price_range" placeholder="e.g., 85000-95000">
                    </div>
                    <div class="form-group">
                        <label>Required Closing Timeline:</label>
                        <input type="text" id="required_timeline" placeholder="e.g., 7-14 days">
                    </div>
                </div>
            </div>

            <button class="btn-primary" onclick="generateOffers()">
                üöÄ Generate Strategic Offers
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results">
            <div class="card">
                <h2>üìä Your Strategic Offer Scenarios</h2>
                
                <div class="presentation-script" id="introScript"></div>

                <div class="offer-comparison" id="offerComparison"></div>

                <div class="presentation-script" id="closingScript"></div>

                <div class="export-buttons">
                    <button class="btn-export" onclick="exportPDF('branded')">
                        üìÑ Export Branded PDF
                    </button>
                    <button class="btn-export" onclick="exportPDF('pro')">
                        ‚≠ê Export Pro PDF (Unbranded)
                    </button>
                    <button class="btn-export" onclick="resetForm()">
                        üîÑ Create New Offers
                    </button>
                </div>
            </div>
        </div>

        <div id="loadingSection" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Generating strategic offers with AI...</p>
        </div>
    </div>

    <script>
        let currentMode = 'simple';
        let strategies = {};
        let currentOffers = null;

        // Load strategies on page load
        fetch('/api/strategies')
            .then(res => res.json())
            .then(data => {
                strategies = data;
                updateStrategyInfo('strategy1', 'info1');
                updateStrategyInfo('strategy2', 'info2');
                toggleMaxOfferField();
            });

        function setMode(mode) {
            currentMode = mode;
            const buttons = document.querySelectorAll('.mode-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const advancedSection = document.getElementById('advancedSettings');
            const modeDescription = document.getElementById('modeDescription');
            
            if (mode === 'advanced') {
                advancedSection.classList.add('show');
                modeDescription.textContent = 'Full control over terms and conditions';
            } else {
                advancedSection.classList.remove('show');
                modeDescription.textContent = 'Quick strategy selection';
            }
        }

        function updateWeight(sliderId, displayId, otherSliderId, otherDisplayId) {
            const value = document.getElementById(sliderId).value;
            document.getElementById(displayId).textContent = value + '%';
            
            // Auto-adjust other slider to maintain 100% total
            const otherValue = 100 - parseInt(value);
            document.getElementById(otherSliderId).value = otherValue;
            document.getElementById(otherDisplayId).textContent = otherValue + '%';
        }

        function updateStrategyInfo(strategySelectId, infoId) {
            const strategy = document.getElementById(strategySelectId).value;
            const info = strategies[strategy];
            
            if (info) {
                const html = `
                    <h4>${info.name}</h4>
                    <p><strong>When to use:</strong> ${info.when_to_use}</p>
                    <p><strong>Pros:</strong></p>
                    <ul>
                        ${info.pros.map(pro => `<li>${pro}</li>`).join('')}
                    </ul>
                `;
                document.getElementById(infoId).innerHTML = html;
            }
        }

        function toggleMaxOfferField() {
            // Show max_offer_field only if either strategy is 'cash'
            const strategy1 = document.getElementById('strategy1').value;
            const strategy2 = document.getElementById('strategy2').value;
            const maxOfferField = document.getElementById('max_offer_field');
            
            if (strategy1 === 'cash' || strategy2 === 'cash') {
                maxOfferField.style.display = 'block';
            } else {
                maxOfferField.style.display = 'none';
            }
            
            // Also toggle creative financing fields
            toggleCreativeFields();
        }
        
        function toggleCreativeFields() {
            const strategy1 = document.getElementById('strategy1').value;
            const strategy2 = document.getElementById('strategy2').value;
            
            // Show/hide Lease Option fields
            const leaseOptionFields = document.querySelectorAll('.lease-option-field');
            const showLeaseOption = (strategy1 === 'lease_option' || strategy2 === 'lease_option');
            leaseOptionFields.forEach(field => {
                field.style.display = showLeaseOption ? 'block' : 'none';
            });
            
            // Show/hide Seller Financing (Wrap) fields
            const sellerFinancingFields = document.querySelectorAll('.seller-financing-field');
            const showSellerFinancing = (strategy1 === 'seller_financing' || strategy2 === 'seller_financing');
            sellerFinancingFields.forEach(field => {
                field.style.display = showSellerFinancing ? 'block' : 'none';
            });
        }

        function applyPreset(preset) {
            switch(preset) {
                case 'sub2_vs_cash':
                    document.getElementById('strategy1').value = 'subject_to';
                    document.getElementById('strategy2').value = 'cash';
                    document.getElementById('weight1').value = 70;
                    document.getElementById('weight2').value = 30;
                    break;
                case 'two_sub2':
                    document.getElementById('strategy1').value = 'subject_to';
                    document.getElementById('strategy2').value = 'subject_to';
                    document.getElementById('weight1').value = 50;
                    document.getElementById('weight2').value = 50;
                    break;
                case 'creative':
                    document.getElementById('strategy1').value = 'lease_option';
                    document.getElementById('strategy2').value = 'seller_financing';
                    document.getElementById('weight1').value = 50;
                    document.getElementById('weight2').value = 50;
                    break;
                case 'stacked':
                    document.getElementById('strategy1').value = 'subject_to';
                    document.getElementById('strategy2').value = 'cash';
                    document.getElementById('weight1').value = 80;
                    document.getElementById('weight2').value = 20;
                    break;
            }
            
            updateWeight('weight1', 'weight1Display', 'weight2', 'weight2Display');
            updateStrategyInfo('strategy1', 'info1');
            updateStrategyInfo('strategy2', 'info2');
            toggleMaxOfferField();
        }

        async function generateOffers() {
            // Show loading
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('loadingSection').style.display = 'block';
            
            // Collect data
            const data = {
                offer_a_strategy: document.getElementById('strategy1').value,
                offer_b_strategy: document.getElementById('strategy2').value,
                offer_a_weight: document.getElementById('weight1').value,
                offer_b_weight: document.getElementById('weight2').value,
                arv: document.getElementById('arv').value,
                mortgage_balance: document.getElementById('mortgage_balance').value,
                arrears: document.getElementById('arrears').value,
                monthly_payment: document.getElementById('monthly_payment').value,
                condition: document.getElementById('condition').value,
                motivation: document.getElementById('motivation_score').value,
                pain_point: document.getElementById('pain_point').value,
                timeline: document.getElementById('timeline').value,
                seller_cash_request: document.getElementById('seller_cash_request').value,
                closing_costs: document.getElementById('closing_costs').value,
                max_offer_pct: document.getElementById('max_offer_percent').value,
                min_profit: document.getElementById('min_profit').value,
                available_cash: document.getElementById('available_cash').value,
                exit_strategy: document.getElementById('exit_strategy').value,
                option_term_months: document.getElementById('option_term_months').value,
                additional_option_price: document.getElementById('additional_option_price').value,
                monthly_payment_markup: document.getElementById('monthly_payment_markup').value,
                additional_purchase_price: document.getElementById('additional_purchase_price').value,
                advanced_mode: currentMode === 'advanced',
                advanced_settings: {}
            };
            
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const offers = await response.json();
                currentOffers = offers;
                displayOffers(offers);
                
                // Show results
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('resultsSection').classList.add('show');
                
            } catch (error) {
                alert('Error generating offers: ' + error.message);
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('inputSection').style.display = 'block';
            }
        }

        function displayOffers(offers) {
            // Intro script
            document.getElementById('introScript').innerHTML = `
                <h3>üìã Presentation Introduction</h3>
                <p>${offers.comparison_intro}</p>
            `;
            
            // Offer cards
            const comparisonHtml = `
                ${createOfferCard(offers.offer_a, 'A')}
                ${createOfferCard(offers.offer_b, 'B')}
            `;
            document.getElementById('offerComparison').innerHTML = comparisonHtml;
            
            // Closing script
            document.getElementById('closingScript').innerHTML = `
                <h3>‚ùì Closing Question</h3>
                <p><strong>"${offers.closing_question}"</strong></p>
            `;
        }

        function createOfferCard(offer, label) {
            return `
                <div class="offer-card">
                    <h3>Option ${label}: ${offer.headline}</h3>
                    
                    <div class="offer-detail">
                        <div class="offer-detail-label">Purchase Price</div>
                        <div class="offer-detail-value">$${offer.purchase_price.toLocaleString()}</div>
                    </div>
                    
                    <div class="offer-detail">
                        <div class="offer-detail-label">Cash at Closing</div>
                        <div class="offer-detail-value">$${offer.cash_at_closing.toLocaleString()}</div>
                    </div>
                    
                    <div class="offer-detail">
                        <div class="offer-detail-label">Payment Structure</div>
                        <div class="offer-detail-value">${offer.payment_structure}</div>
                    </div>
                    
                    <div class="offer-detail">
                        <div class="offer-detail-label">Closing Timeline</div>
                        <div class="offer-detail-value">${offer.timeline_days} days</div>
                    </div>
                    
                    <div class="benefits-list">
                        <h4>Why This Works for You:</h4>
                        <ul>
                            ${offer.seller_benefits.map(b => `<li>${b}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="presentation-script" style="margin-top: 20px;">
                        <h4>Presentation Script:</h4>
                        <p style="font-size: 13px;">${offer.presentation_script}</p>
                    </div>
                    
                    <div style="background: #0d0d0d; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h4 style="color: #ff9800; margin-bottom: 8px; font-size: 13px;">üìù Investor Notes:</h4>
                        <p style="font-size: 12px; color: #9e9e9e;">${offer.investor_notes}</p>
                    </div>
                </div>
            `;
        }

        async function exportPDF(format) {
            try {
                const response = await fetch('/api/export-pdf', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        offers: currentOffers,
                        format: format
                    })
                });
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `offer_comparison_${format}_${new Date().toISOString().split('T')[0]}.pdf`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
            } catch (error) {
                alert('Error exporting PDF: ' + error.message);
            }
        }

        function resetForm() {
            document.getElementById('resultsSection').classList.remove('show');
            document.getElementById('inputSection').style.display = 'block';
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
